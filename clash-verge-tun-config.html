<!DOCTYPE html><html lang="en"><head><link href="https://unpkg.com/@splidejs/splide@4.1.4/dist/css/splide.min.css" rel="stylesheet"><style type="text/css">.splide{border:2px solid var(--carousel-border-color);box-shadow:0 4px 8px var(--carousel-shadow-color);border-radius:var(--carousel-border-radius)}.splide__slide img{width:100%;height:100%;object-fit:contain}.carousel-container{visibility:inherit;margin-top:20px;margin-bottom:20px}.carousel-caption{min-height:2em;line-height:2em;text-align:center;font-size:.9em;font-style:italic;padding:6px;margin-left:auto;margin-right:auto}.splide__arrow{background:0 0;align-items:center;border:0;cursor:pointer;display:flex;height:5em;justify-content:center;position:absolute;top:50%;transform:translateY(-50%);width:5em;z-index:10}.splide__arrow:disabled{opacity:0}.splide__arrow--prev{left:0}.splide__arrow--next{right:0}.splide__arrow svg{fill:var(--carousel-arrow-color);height:2.5em;transition:fill .2s linear;width:2.5em}.splide__arrow:hover:not(:disabled) svg{fill:var(--carousel-arrow-hover-color)}.splide__arrow:focus-visible{outline:transparent;outline-offset:0}.splide.is-focus-in .splide__arrow:focus{outline:transparent;outline-offset:0}.splide__pagination__page:focus-visible{outline:transparent;outline-offset:0}.splide.is-focus-in .splide__pagination__page:focus{outline:transparent;outline-offset:0}.splide__pagination{bottom:1em;left:0;padding:0 1em;position:absolute;right:0;z-index:1}.splide__pagination__page{background:var(--carousel-pagination-color);border:0;border-radius:2.5px;display:inline-block;height:5px;margin:3px;width:20px;transition:background-color .2s linear}.splide__pagination__page.is-active{background:var(--carousel-pagination-active-color)}.splide__pagination__page:hover{background:var(--carousel-pagination-hover-color);cursor:pointer;opacity:.9}.splide__pagination__page::before{content:'';position:absolute;top:-18px;bottom:-18px;left:-4px;right:-4px}.splide__pagination__page.is-active::before{content:'';position:absolute;top:-12px;bottom:-12px;left:-1px;right:-1px}.zoomable{object-fit:contain}.zooming{max-width:90vw!important;max-height:90vh!important;object-fit:contain!important}</style><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><link rel="manifest" href="/en/images/site.webmanifest"><meta name="msvalidate.01" content="BE3DB9F22A0915AF3452024048D66934"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300italic,400,400italic,700,700italic%7CNoto+Serif:300,300italic,400,400italic,700,700italic%7CFira+Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-flash.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"siriusq.top","root":"/en/","images":"/en/images","scheme":"Gemini","darkmode":"auto","version":"8.20.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":320,"display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":false,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><meta name="description" content="In this article, I will document the configuration process for Clash Verge, including creating configuration files, switching kernels, enabling TUN mode, and preventing DNS leaks."><meta property="og:type" content="article"><meta property="og:title" content="Clash Verge TUN Mode Configuration Guide"><meta property="og:url" content="https://siriusq.top/en/clash-verge-tun-config.html"><meta property="og:site_name" content="Sirius"><meta property="og:description" content="In this article, I will document the configuration process for Clash Verge, including creating configuration files, switching kernels, enabling TUN mode, and preventing DNS leaks."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://s2.loli.net/2023/11/07/oxCNTsQD7e1kOr8.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/3x7UNVTWB9CRyIS.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/Yy6gmS9fWNtMoAn.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/QRPDxwrfScWuedH.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/beujaYXTOGxI6QH.png"><meta property="og:image" content="https://s2.loli.net/2023/11/07/MHlXcj5w8BaoSzR.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/f7tDroGg6ki4ABc.png"><meta property="og:image" content="https://s2.loli.net/2023/11/07/IcLue7z4wQXbgrE.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/b2xKeHRt9Q1vEhg.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/knJhg7UmZ9CiAND.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/C83lsBwJdkQVvUM.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/qGsfuEZ3wkNoQCe.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/HYdAhQRgjTGiCMt.webp"><meta property="og:image" content="https://s2.loli.net/2023/11/07/9SWefoV7j5FlQku.webp"><meta property="article:published_time" content="2023-11-04T09:24:07.000Z"><meta property="article:modified_time" content="2024-09-13T16:13:50.996Z"><meta property="article:author" content="Sirius"><meta property="article:tag" content="Clash"><meta property="article:tag" content="GFW"><meta property="article:tag" content="Tun"><meta property="article:tag" content="Win11"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2023/11/07/oxCNTsQD7e1kOr8.webp"><link rel="canonical" href="https://siriusq.top/en/clash-verge-tun-config.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://siriusq.top/en/clash-verge-tun-config.html","path":"clash-verge-tun-config.html","title":"Clash Verge TUN Mode Configuration Guide"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Clash Verge TUN Mode Configuration Guide | Sirius</title><script src="/en/live2d-widget/autoload.js"></script><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Sirius" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Sirius</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">May the Force be with you</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/en/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/en/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">102</span></a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">11</span></a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">67</span></a></li><li class="menu-item menu-item-tools"><a href="/en/tools/" rel="section"><i class="fa fa-screwdriver-wrench fa-fw"></i>Tools</a></li><li class="menu-item menu-item-switch-to-chinese"><a href="https://siriusq.top/" rel="section"><i class="fa fa-language fa-fw"></i>Switch to Chinese</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Background"><span class="nav-number">1.</span> <span class="nav-text">Background</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Download-and-Installation"><span class="nav-number">2.</span> <span class="nav-text">Download and Installation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic-Configuration"><span class="nav-number">3.</span> <span class="nav-text">Basic Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Switch-Clash-Core"><span class="nav-number">3.1.</span> <span class="nav-text">Switch Clash Core</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set-External-Controller"><span class="nav-number">3.2.</span> <span class="nav-text">Set External Controller</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Additional-Configuration"><span class="nav-number">3.3.</span> <span class="nav-text">Additional Configuration</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuration-File-Setup"><span class="nav-number">4.</span> <span class="nav-text">Configuration File Setup</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enable-TUN-Mode"><span class="nav-number">5.</span> <span class="nav-text">Enable TUN Mode</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Prevent-DNS-Leaks"><span class="nav-number">6.</span> <span class="nav-text">Prevent DNS Leaks</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Turn-Off-Smart-Multi-Homed-Name-Resolution"><span class="nav-number">6.1.</span> <span class="nav-text">Turn Off Smart Multi-Homed Name Resolution</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Disable-QUIC"><span class="nav-number">6.2.</span> <span class="nav-text">Disable QUIC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Disable-Browser-Secure-DNS"><span class="nav-number">6.3.</span> <span class="nav-text">Disable Browser Secure DNS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enabling-Clash-DNS-Server-and-Setting-Local-DNS-Server"><span class="nav-number">6.4.</span> <span class="nav-text">Enabling Clash DNS Server and Setting Local DNS Server</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Sirius" src="https://s2.loli.net/2022/05/23/kxtRKT4u71HXlUY.gif"><p class="site-author-name" itemprop="name">Sirius</p><div class="site-description" itemprop="description">Thread_sleep(1); //be nice to the CPU</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/en/archives/"><span class="site-state-item-count">67</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/en/categories/"><span class="site-state-item-count">11</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/en/tags/"><span class="site-state-item-count">102</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Siriusq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Siriusq" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="/en/atom.xml" title="RSS Feed → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i>RSS Feed</a> </span><span class="links-of-author-item"><a href="mailto:siriusq.top@outlook.com" title="E-Mail → mailto:siriusq.top@outlook.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="https://leetcode.com/Siriusq/" title="LeetCode → https:&#x2F;&#x2F;leetcode.com&#x2F;Siriusq&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-code fa-fw"></i>LeetCode</a></span></div><script src="/en/js/switch_limited.js"></script></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://siriusq.top/en/clash-verge-tun-config.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://s2.loli.net/2022/05/23/kxtRKT4u71HXlUY.gif"><meta itemprop="name" content="Sirius"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sirius"><meta itemprop="description" content="Thread_sleep(1); //be nice to the CPU"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Clash Verge TUN Mode Configuration Guide | Sirius"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Clash Verge TUN Mode Configuration Guide</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-11-04 17:24:07" itemprop="dateCreated datePublished" datetime="2023-11-04T17:24:07+08:00">2023-11-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-09-14 00:13:50" itemprop="dateModified" datetime="2024-09-14T00:13:50+08:00">2024-09-14</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Free-Internet/" itemprop="url" rel="index"><span itemprop="name">Free Internet</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Word count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Word count in article: </span><span>2.4k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>9 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center">In this article, I will document the configuration process for Clash Verge, including creating configuration files, switching kernels, enabling TUN mode, and preventing DNS leaks.</blockquote><span id="more"></span><h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>On the afternoon of November 2, 2023, the Clash for Windows (CFW) repository was deleted. Later that evening, related topics surged to the top ten on Weibo’s trending list, attracting some malicious self-media to add fuel to the fire, and rumors were flying. The following day, most of the Clash-related repositories took measures such as deletion or archiving and switching branches to temporarily avoid the limelight. Since CFW is no longer being updated, I decided to switch from CFW to Clash Verge for security reasons.</p><h1 id="Download-and-Installation"><a href="#Download-and-Installation" class="headerlink" title="Download and Installation"></a>Download and Installation</h1><p>Here is Clash Verge’s GitHub Release page. Please choose the appropriate installation package according to your operating system:</p><ul><li>Windows users can download <code>Clash.Verge_1.x.x_x64_zh-CN.msi</code></li><li>Mac users with Intel CPUs can download <code>Clash.Verge_1.x.x_x64.dmg</code></li><li>Mac users with M-series CPUs can download <code>Clash.Verge_1.x.x_aarch64.dmg</code></li></ul><div class="link-grid"><div class="link-grid-container"><object class="link-grid-image" data="/images/link/github.webp"></object><p>Clash Verge</p><p>Clash Verge Rev Release Page</p><a target="_blank" rel="noopener" href="https://github.com/clash-verge-rev/clash-verge-rev/releases"></a></div></div><p>The installation process is very straightforward. Simply click <code>Next</code> repeatedly, and no additional settings are required.</p><h1 id="Basic-Configuration"><a href="#Basic-Configuration" class="headerlink" title="Basic Configuration"></a>Basic Configuration</h1><p>First, click on <code>Settings</code> in the left sidebar to open the settings page.</p><details class="note success"><summary><p>Outdated</p></summary><h2 id="Switch-Clash-Core"><a href="#Switch-Clash-Core" class="headerlink" title="Switch Clash Core"></a>Switch Clash Core</h2><p>The new version of Clash Verge has removed the Clash Premium kernel, eliminating the need for additional kernel settings.</p><p><del>Clash Verge supports two cores: Clash Premium (closed-source and repo deleted) and Clash Meta (open-source). By default, Clash Premium is used, but it’s recommended to switch to Clash Meta.</del></p><ol><li><p><del>In <code>Settings</code>, locate the <code>Clash Core</code> section and click the small gear icon next to it.</del></p></li><li><p><del>Select <code>Clash Meta</code>.</del></p></li><li><p><del>Click <code>Restart</code> in the upper right corner.</del></p><div class="carousel-container"><div class="splide" data-splide='{"heightRatio":0.618,"lazyLoad":false,"type":"slide","autoplay":false,"interval":3000,"pauseOnHover":true}' data-caption-id="carousel-caption-ktbaq81as"><div class="splide__track"><ul class="splide__list"><li class="splide__slide" data-caption="Switch Clash Core.webp"><img data-src="https://s2.loli.net/2023/11/07/oxCNTsQD7e1kOr8.webp" alt="Switch Clash Core.webp" class="zoomable"></li><li class="splide__slide" data-caption="Choose Clash Core And Restart.webp"><img data-src="https://s2.loli.net/2023/11/07/3x7UNVTWB9CRyIS.webp" alt="Choose Clash Core And Restart.webp" class="zoomable"></li></ul></div></div><div id="carousel-caption-ktbaq81as" class="carousel-caption"></div></div></li></ol></details><h2 id="Set-External-Controller"><a href="#Set-External-Controller" class="headerlink" title="Set External Controller"></a>Set External Controller</h2><p>Previously, a vulnerability in Clash was exposed, allowing attackers to inject malware via the RESTful API interface. For security reasons, I changed the default external control port and added a password. For more details, refer to <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=4AnapDDMlyI">@bulianglin’s YouTube video</a>.</p><ol><li>In <code>Settings</code>, locate the <code>External</code> section and click the arrow icon next to it.</li><li>Modify the port for <code>External Controller</code>, the default value is <code>9090</code>, and you can change it to other port like <code>11451</code>.</li><li>Enter a password in <code>Core Secret</code>.</li><li>Save the settings.</li></ol><h2 id="Additional-Configuration"><a href="#Additional-Configuration" class="headerlink" title="Additional Configuration"></a>Additional Configuration</h2><p>Here are some of my own configurations for reference. Adjust them based on your specific needs.</p><ul><li>Disable <code>IPv6</code></li><li>Disable <code>Allow LAN</code></li><li>Enable <code>Auto Launch</code></li><li>Enable <code>Silent Start</code></li></ul><h1 id="Configuration-File-Setup"><a href="#Configuration-File-Setup" class="headerlink" title="Configuration File Setup"></a>Configuration File Setup</h1><ol><li>Click on <code>Profiles</code> in the left sidebar.</li><li>Click <code>New</code> in the upper right corner.</li><li>Choose <code>Local</code> as the type, name it as you like, and leave the other two fields blank.<ul><li>For more configuration file types, please refer to <a target="_blank" rel="noopener" href="https://github.com/zzzgydi/clash-verge/wiki/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97">Clash Verge Wiki</a>。</li></ul></li><li>Click <code>Save</code>。</li><li>Right-click on the newly created configuration item, you can select <code>Edit File</code>, which will open the configuration file by clash verge itself, or select <code>Open File</code>, which will open the configuration file using VSCode.</li><li>Fill in your configuration and save it.<ul><li>If you are not familiar with the configuration, you can refer to the <a target="_blank" rel="noopener" href="https://wiki.metacubex.one/example/">Clash Meta Documentation</a>, which provides example configurations that you can use.</li><li>You can also directly use most of the configuration from your CFW configuration file.</li></ul></li></ol><div class="carousel-container"><div class="splide" data-splide='{"heightRatio":0.618,"lazyLoad":false,"type":"slide","autoplay":false,"interval":3000,"pauseOnHover":true}' data-caption-id="carousel-caption-jcv99vckv"><div class="splide__track"><ul class="splide__list"><li class="splide__slide" data-caption="New Profile.webp"><img data-src="https://s2.loli.net/2023/11/07/Yy6gmS9fWNtMoAn.webp" alt="New Profile.webp" class="zoomable"></li><li class="splide__slide" data-caption="Edit Profile.webp"><img data-src="https://s2.loli.net/2023/11/07/QRPDxwrfScWuedH.webp" alt="Edit Profile.webp" class="zoomable"></li></ul></div></div><div id="carousel-caption-jcv99vckv" class="carousel-caption"></div></div><details class="note success"><summary><p>My Configuration File</p></summary><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mixed-port:</span> <span class="number">7890</span> <span class="comment"># proxy port</span></span><br><span class="line"><span class="attr">allow-lan:</span> <span class="literal">false</span> <span class="comment"># Do not allow other devices to access the Internet through the Clash&#x27;s proxy port.</span></span><br><span class="line"><span class="attr">external-controller:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:11451</span> <span class="comment"># RESTful API listener address, the default port 9090, it is recommended to change to other ports.</span></span><br><span class="line"><span class="attr">secret:</span> <span class="string">&quot;Woshiyigemeiyouganqingdemima!&quot;</span> <span class="comment"># API access key</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># host: # Grasscutter, Launch！</span></span><br><span class="line"><span class="comment">#   &#x27;*.mihoyo.com&#x27;: 127.0.0.1</span></span><br><span class="line"><span class="comment">#   &#x27;*.yuanshen.com&#x27;: 127.0.0.1</span></span><br><span class="line"><span class="comment">#   &#x27;*.hoyoverse.com&#x27;: 127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">profile:</span></span><br><span class="line">  <span class="attr">store-selected:</span> <span class="literal">true</span> <span class="comment"># Stores the API&#x27;s selection of policy groups for use at next startup.</span></span><br><span class="line">  <span class="attr">store-fake-ip:</span> <span class="literal">true</span> <span class="comment"># Store the fakeip mapping table and use the original mapping address when the domain name is connected again.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sniffer:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># Enable Domain Sniffing</span></span><br><span class="line">  <span class="attr">sniff:</span></span><br><span class="line">    <span class="attr">TLS:</span></span><br><span class="line">      <span class="attr">ports:</span> [<span class="number">443</span>, <span class="number">8443</span>]</span><br><span class="line">    <span class="attr">HTTP:</span></span><br><span class="line">      <span class="attr">ports:</span> [<span class="number">80</span>, <span class="string">&#x27;8080-8880&#x27;</span>]</span><br><span class="line">      <span class="attr">override-destination:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tun:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">stack:</span> <span class="string">system</span> <span class="comment"># For Mac Users, please use &quot;gvisor&quot; instead.</span></span><br><span class="line">  <span class="attr">dns-hijack:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;any:53&#x27;</span> <span class="comment"># dns hijacking, usually set to any:53, that is, hijacking all udp traffic on port 53.</span></span><br><span class="line">  <span class="attr">auto-route:</span> <span class="literal">true</span> <span class="comment"># Auto-set global routing, which can automatically route global traffic into the tun card.</span></span><br><span class="line">  <span class="attr">auto-detect-interface:</span> <span class="literal">true</span> <span class="comment"># Automatic selection of the traffic outlet interface.</span></span><br><span class="line">  <span class="attr">strict-route:</span> <span class="literal">true</span> <span class="comment"># Strict routing, which prevents address leakage.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">prefer-h3:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">listen:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:53</span> <span class="comment"># dns service listener</span></span><br><span class="line">  <span class="attr">ipv6:</span> <span class="literal">true</span> <span class="comment"># Whether to resolve IPV6, if false, responds an AAAA null resolution.</span></span><br><span class="line">  <span class="attr">enhanced-mode:</span> <span class="string">fake-ip</span> <span class="comment"># Clash&#x27;s dns processing model.</span></span><br><span class="line">  <span class="attr">fake-ip-range:</span> <span class="number">28.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">/8</span> <span class="comment"># The IP segment setting under fakeip, the default ip of tun NIC also uses this value.</span></span><br><span class="line">  <span class="attr">use-hosts:</span> <span class="literal">true</span> <span class="comment"># Whether to query system hosts.</span></span><br><span class="line">  <span class="attr">fake-ip-filter:</span> <span class="comment"># fakeip filtering, the following addresses will not be issued fakeip mappings for connections.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;+.lan&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;+.local&#x27;</span></span><br><span class="line">  <span class="attr">default-nameserver:</span> <span class="comment"># default dns, domain name for resolving DNS servers in nameserver section, must be ip, can be encrypted dns.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">119.29</span><span class="number">.29</span><span class="number">.29</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">223.5</span><span class="number">.5</span><span class="number">.5</span></span><br><span class="line">  <span class="attr">nameserver:</span> <span class="comment"># Default nameserver, if you don&#x27;t configure fallback/proxy-server-nameserver , then all domain names will be resolved by nameserver.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://doh.pub/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://dns.alidns.com/dns-query</span></span><br><span class="line">  <span class="attr">fallback:</span> <span class="comment"># Backup domain name resolution servers, in general, the use of foreign DNS, to ensure that the results are credible, after the configuration of fallback, fallback-filter is enabled by default.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://1.0.0.1/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://1.1.1.1/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://9.9.9.9/dns-query</span></span><br><span class="line">  <span class="attr">proxy-server-nameserver:</span> <span class="comment"># Proxy node domain name resolution server, only used to resolve the domain name of the proxy node</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://9.9.9.9/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://1.12.12.12/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://223.5.5.5/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://1.1.1.1/dns-query</span></span><br><span class="line">  <span class="attr">nameserver-policy:</span> <span class="comment"># Specify the resolving server for domain name queries, can use geosite, preferred over nameserver/fallback queries.</span></span><br><span class="line">    <span class="string">&quot;geosite:cn,private&quot;</span><span class="string">:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">https://doh.pub/dns-query</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">https://dns.alidns.com/dns-query</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Proxy settings, using Just My Socks as an example</span></span><br><span class="line"><span class="attr">proxies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jms-s1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ss</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">xxxx1.xxxxx.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">cipher:</span> <span class="string">aes-256-gcm</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jms-s2</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ss</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">xxxx2.xxxxx.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">cipher:</span> <span class="string">aes-256-gcm</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jms-s3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">vmess</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">xxxx3.xxxxx.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">xxx-114514-xxxxxx</span></span><br><span class="line">    <span class="attr">alterId:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">cipher:</span> <span class="string">auto</span></span><br><span class="line">    <span class="comment"># tls: true</span></span><br><span class="line">    <span class="comment"># skip-cert-verify: true</span></span><br><span class="line">    <span class="comment"># servername: example.com</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jms-s4</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">vmess</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">xxxx4.xxxxx.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">xxx-114514-xxxxxx</span></span><br><span class="line">    <span class="attr">alterId:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">cipher:</span> <span class="string">auto</span></span><br><span class="line">    <span class="comment"># tls: true</span></span><br><span class="line">    <span class="comment"># skip-cert-verify: true</span></span><br><span class="line">    <span class="comment"># h2-opts:</span></span><br><span class="line">    <span class="comment">#   host:</span></span><br><span class="line">    <span class="comment">#     - http.example.com</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jms-s5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">vmess</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">xxxx5.xxxxx.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">xxx-114514-xxxxxx</span></span><br><span class="line">    <span class="attr">alterId:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">cipher:</span> <span class="string">auto</span></span><br><span class="line">    <span class="comment"># tls: true</span></span><br><span class="line">    <span class="comment"># skip-cert-verify: true</span></span><br><span class="line">    <span class="comment"># servername: example.com</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jms-s801</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">vmess</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">xxxx801.xxxxx.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">xxx-114514-xxxxxx</span></span><br><span class="line">    <span class="attr">alterId:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">cipher:</span> <span class="string">auto</span></span><br><span class="line">    <span class="comment"># tls: true</span></span><br><span class="line">    <span class="comment"># skip-cert-verify: true</span></span><br><span class="line">    <span class="comment"># servername: example.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Policy Groups, I only used the manual selection of this one</span></span><br><span class="line"><span class="attr">proxy-groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROXY</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">jms-s1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">jms-s2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">jms-s3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">jms-s4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">jms-s5</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">jms-s801</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For the ruleset, I used [Loyalsoldier&#x27;s](https://github.com/Loyalsoldier/clash-rules) ruleset.</span></span><br><span class="line"><span class="attr">rule-providers:</span></span><br><span class="line">  <span class="attr">reject:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/reject.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">icloud:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/icloud.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">apple:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/apple.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">google:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/google.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">proxy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/proxy.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">direct:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/direct.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">private:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/private.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">gfw:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/gfw.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tld-not-cn:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">domain</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/tld-not-cn.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">telegramcidr:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">ipcidr</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/telegramcidr.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cncidr:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">ipcidr</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/cncidr.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">lancidr:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">ipcidr</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/lancidr.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">applications:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">behavior:</span> <span class="string">classical</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt&quot;</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./ruleset/applications.yaml</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">86400</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Rules</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,applications,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN,clash.razord.top,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN,yacd.haishan.me,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,private,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,reject,REJECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,icloud,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,apple,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,google,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,proxy,PROXY</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,direct,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,lancidr,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,cncidr,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">RULE-SET,telegramcidr,PROXY</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GEOIP,LAN,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GEOIP,CN,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">MATCH,PROXY</span></span><br><span class="line"></span><br><span class="line"><span class="attr">geodata-mode:</span> <span class="literal">true</span> <span class="comment"># Using geoip files in dat format</span></span><br><span class="line"><span class="attr">geox-url:</span> <span class="comment"># Custom geo download address</span></span><br><span class="line">  <span class="attr">geoip:</span> <span class="string">&quot;https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat&quot;</span></span><br><span class="line">  <span class="attr">geosite:</span> <span class="string">&quot;https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat&quot;</span></span><br><span class="line">  <span class="attr">mmdb:</span> <span class="string">&quot;https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb&quot;</span></span><br></pre></td></tr></table></figure></details><div class="note primary"><p>For more configuration options, please refer to the <a target="_blank" rel="noopener" href="https://wiki.metacubex.one/config/">Clash.Meta Official Documentation</a>.</p></div><h1 id="Enable-TUN-Mode"><a href="#Enable-TUN-Mode" class="headerlink" title="Enable TUN Mode"></a>Enable TUN Mode</h1><p>TUN interface is a virtual network interface that allows communication between user-space programs and the core to pass packets from one network stack to another. Clash Meta supports enabling TUN mode, which takes control of layer 3 packets in the user’s network by creating a TUN virtual NIC. In TUN mode, all applications and traffic are forced to route through the proxy server, regardless of whether the application supports proxy settings.</p><ol><li>Click <code>Settings</code> in the left sidebar and locate <code>Service Mode</code> and click on the small shield icon next to it.</li><li>Click <code>INSTALL</code>.<ul><li>Installation may report a failure, but it is actually successful; this may be a bug.</li></ul></li><li>Turn on the switch for <code>Service Mode</code> and <code>Tun Mode</code>, then turn off the switch for <code>System Proxy</code>.</li><li>If the network icon in the lower left corner of the taskbar changes from Wi-Fi to the icon shown in the screenshot below, the installation was successful.<br><img data-src="https://s2.loli.net/2023/11/07/beujaYXTOGxI6QH.png" alt="icon screenshot.png"></li><li>Click on <code>Profiles</code> in the left sidebar, right-click on the configuration profile you created earlier, and click <code>Select</code>。</li></ol><div class="carousel-container"><div class="splide" data-splide='{"heightRatio":0.618,"lazyLoad":false,"type":"slide","autoplay":false,"interval":3000,"pauseOnHover":true}' data-caption-id="carousel-caption-cwg6cq7yl"><div class="splide__track"><ul class="splide__list"><li class="splide__slide" data-caption="Install Service Mode.webp"><img data-src="https://s2.loli.net/2023/11/07/MHlXcj5w8BaoSzR.webp" alt="Install Service Mode.webp" class="zoomable"></li><li class="splide__slide" data-caption="Click INSTALL.png"><img data-src="https://s2.loli.net/2023/11/07/f7tDroGg6ki4ABc.png" alt="Click INSTALL.png" class="zoomable"></li><li class="splide__slide" data-caption="Enable/Disable relevant options.webp"><img data-src="https://s2.loli.net/2023/11/07/IcLue7z4wQXbgrE.webp" alt="Enable/Disable relevant options.webp" class="zoomable"></li><li class="splide__slide" data-caption="Select Profile.webp"><img data-src="https://s2.loli.net/2023/11/07/b2xKeHRt9Q1vEhg.webp" alt="Select Profile.webp" class="zoomable"></li></ul></div></div><div id="carousel-caption-cwg6cq7yl" class="carousel-caption"></div></div><h1 id="Prevent-DNS-Leaks"><a href="#Prevent-DNS-Leaks" class="headerlink" title="Prevent DNS Leaks"></a>Prevent DNS Leaks</h1><p>DNS leaks are a network privacy issue that typically occurs when using a Virtual Private Network (VPN) or proxy service. It refers to the situation where DNS queries bypass the VPN or proxy and are sent directly to a local or public DNS server. This can potentially leak information about a user’s online activities, as DNS queries often contain information about the websites being accessed, even if their network traffic is encrypted and hidden by a VPN or proxy.</p><p>For more information about DNS leaks, please refer to @bulianglin’s YouTube video:</p><ul><li><a target="_blank" rel="noopener" href="https://youtu.be/fqREM6b25SY">Advanced - DNS Leakage Chapter</a></li><li><a target="_blank" rel="noopener" href="https://youtu.be/aKlH6KRt9Jc">Advanced - DNS Triage Chapter</a></li><li><a target="_blank" rel="noopener" href="https://youtu.be/50iVDmqzDW8">Advanced - DNS Proxy Chapter</a></li></ul><h2 id="Turn-Off-Smart-Multi-Homed-Name-Resolution"><a href="#Turn-Off-Smart-Multi-Homed-Name-Resolution" class="headerlink" title="Turn Off Smart Multi-Homed Name Resolution"></a>Turn Off Smart Multi-Homed Name Resolution</h2><p>Windows operating systems use Smart Multi-Homed Domain Name Resolution to issue parallel DNS queries to all networks simultaneously for improved performance. Even though I have configured DNS rules in the settings, these rules only apply to the TUN virtual network card set up by Clash, and they do not control the physical network card. Therefore, without disabling Smart Multi-Homed Name Resolution, the system might initiate DNS queries through both the virtual network card and the physical network card. The physical network card typically uses local or public DNS servers, meaning that third parties like your internet service provider can see the websites you’re visiting. This is when DNS leaks occur.</p><p>You can use Wireshark to capture data from the physical network card and compare the differences before and after disabling Smart Multi-Homed Name Resolution.</p><p>To disable it, follow these steps:</p><ol><li>Open the Start menu and search for <code>Edit Group Policy</code> and open the corresponding Control Panel.</li><li>Navigate to <code>Computer Configuration</code> &gt; <code>Administrative Templates</code> &gt; <code>Network</code> &gt; <code>DNS Client</code>.</li><li>Find and click on <code>Turn off smart multi-homed name resolution</code>.</li><li>Check the <code>Enabled</code> option in the upper left corner.</li><li>Click <code>OK</code>.</li></ol><div class="carousel-container"><div class="splide" data-splide='{"heightRatio":0.618,"lazyLoad":false,"type":"slide","autoplay":false,"interval":3000,"pauseOnHover":true}' data-caption-id="carousel-caption-l64s31roa"><div class="splide__track"><ul class="splide__list"><li class="splide__slide" data-caption="Search For Edit Group Policy.webp"><img data-src="https://s2.loli.net/2023/11/07/knJhg7UmZ9CiAND.webp" alt="Search For Edit Group Policy.webp" class="zoomable"></li><li class="splide__slide" data-caption="Find Relevant Options.webp"><img data-src="https://s2.loli.net/2023/11/07/C83lsBwJdkQVvUM.webp" alt="Find Relevant Options.webp" class="zoomable"></li><li class="splide__slide" data-caption="Cliick Enabled.webp"><img data-src="https://s2.loli.net/2023/11/07/qGsfuEZ3wkNoQCe.webp" alt="Cliick Enabled.webp" class="zoomable"></li></ul></div></div><div id="carousel-caption-l64s31roa" class="carousel-caption"></div></div><h2 id="Disable-QUIC"><a href="#Disable-QUIC" class="headerlink" title="Disable QUIC"></a>Disable QUIC</h2><p>QUIC (Quick UDP Internet Connections) is a network transport protocol designed to accelerate data transmission on the Internet and provide faster network connections. Developed by Google, QUIC has been standardized to improve network performance and security. An increasing number of web browsers are beginning to support QUIC to enhance users’ online experiences. However, in certain cases, QUIC can lead to DNS leaks. Therefore, it is recommended to disable QUIC in your web browser.</p><blockquote><p>Since UDP must use real IP in some scenarios, Clash currently sends DNS requests for UDP traffic domains, even when using fake IP mode. For example, the UDP-based QUIC protocol used by browsers for HTTP3 will initiate DNS requests when accessing websites that support QUIC. This can result in DNS leaks. The solution is to disable the QUIC feature in your web browser.<br>Quoted from <a target="_blank" rel="noopener" href="https://bulianglin.com/archives/dns.html">Advanced • DNS Shunting Section</a></p></blockquote><p>As an example, for Microsoft Edge browser, you can enter <code>edge://flags/#enable-quic</code> in the address bar, which will take you to the <code>Experimental QUIC protocol</code> option. Set it to <code>Disabled</code>.</p><div class="carousel-container"><div class="splide" data-splide='{"heightRatio":0.618,"lazyLoad":false,"type":"slide","autoplay":false,"interval":3000,"pauseOnHover":true}' data-caption-id="carousel-caption-05ghqk5x8"><div class="splide__track"><ul class="splide__list"><li class="splide__slide" data-caption="Disable QUIC.webp"><img data-src="https://s2.loli.net/2023/11/07/HYdAhQRgjTGiCMt.webp" alt="Disable QUIC.webp" class="zoomable"></li></ul></div></div><div id="carousel-caption-05ghqk5x8" class="carousel-caption"></div></div><h2 id="Disable-Browser-Secure-DNS"><a href="#Disable-Browser-Secure-DNS" class="headerlink" title="Disable Browser Secure DNS"></a>Disable Browser Secure DNS</h2><p>Most modern web browsers now have <code>Secure DNS</code> features enabled by default, which can interfere with TUN mode by hijacking DNS requests, causing reverse domain name resolution to fail.</p><p>Taking Microsoft Edge browser as an example, go to <code>Settings</code> &gt; <code>Privacy, search, and services</code> &gt; <code>Security</code> &gt; <code>Use secure DNS to specify how to look up the network address of websites</code>. Turn off the switch.</p><div class="carousel-container"><div class="splide" data-splide='{"heightRatio":0.618,"lazyLoad":false,"type":"slide","autoplay":false,"interval":3000,"pauseOnHover":true}' data-caption-id="carousel-caption-45hb0ahui"><div class="splide__track"><ul class="splide__list"><li class="splide__slide" data-caption="Disabl Browser Secure DNS.webp"><img data-src="https://s2.loli.net/2023/11/07/9SWefoV7j5FlQku.webp" alt="Disabl Browser Secure DNS.webp" class="zoomable"></li></ul></div></div><div id="carousel-caption-45hb0ahui" class="carousel-caption"></div></div><h2 id="Enabling-Clash-DNS-Server-and-Setting-Local-DNS-Server"><a href="#Enabling-Clash-DNS-Server-and-Setting-Local-DNS-Server" class="headerlink" title="Enabling Clash DNS Server and Setting Local DNS Server"></a>Enabling Clash DNS Server and Setting Local DNS Server</h2><p>After configuring Clash DNS service in the configuration file, set the local system DNS server to <code>127.0.0.1</code>. Taking WLAN as an example, follow these steps: Open <code>System Settings</code> &gt; <code>Network &amp; Internet</code> &gt; <code>Wi-Fi</code> &gt; <code>Hardware Properties</code>, set <code>DNS Server Assignment</code> to manual, enable <code>IPv4</code>, input <code>127.0.0.1</code> in <code>Preferred DNS</code>, and save the settings.</p></div><footer class="post-footer"><div><div style="text-align:center;color:#ccc;font-size:14px">---------- This article ends here. <i class="fa fa-dice-d20"></i> Thank you for reading! ----------</div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>Post author: </strong>Sirius</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://siriusq.top/en/clash-verge-tun-config.html" title="Clash Verge TUN Mode Configuration Guide">https://siriusq.top/en/clash-verge-tun-config.html</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="post-tags"><a href="/en/tags/Clash/" rel="tag"><i class="fa fa-tag"></i> Clash</a> <a href="/en/tags/GFW/" rel="tag"><i class="fa fa-tag"></i> GFW</a> <a href="/en/tags/Tun/" rel="tag"><i class="fa fa-tag"></i> Tun</a> <a href="/en/tags/Win11/" rel="tag"><i class="fa fa-tag"></i> Win11</a></div><div class="post-nav"><div class="post-nav-item"><a href="/en/auto-update-profile-latest-blog-posts.html" rel="prev" title="Automatically Update the Recent Blog Posts Section in the Custom Profile README When a GitHub Pages-Based Blog Is Updated."><i class="fa fa-angle-left"></i> Automatically Update the Recent Blog Posts Section in the Custom Profile README When a GitHub Pages-Based Blog Is Updated.</a></div><div class="post-nav-item"><a href="/en/grasscutter.html" rel="next" title="Grasscutter Windows Local Server Configuration Guide">Grasscutter Windows Local Server Configuration Guide <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments gitalk-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Sirius</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="Word count total">131k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="Reading time total">7:56</span></span></div><div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("03/31/2019 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="This site has been running safely for "+dnum+" days ",document.getElementById("times").innerHTML=hnum+" hrs "+mnum+" mins "+snum+" secs"}setInterval("createtime()",250)</script></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/sidebar.js"></script><script src="/en/js/next-boot.js"></script><script src="/en/js/bookmark.js"></script><script src="/en/js/pjax.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script src="/en/js/third-party/fancybox.js"></script><script src="/en/js/third-party/pace.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://siriusq.top/en/clash-verge-tun-config.html"}</script><script src="/en/js/third-party/quicklink.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous"><script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"Siriusq","repo":"gitalk-commnet","client_id":"4217cae26df745a55acd","client_secret":"b7f2cc0c82be38a4e0f294f12f761bc4799669cd","admin_user":"Siriusq","distraction_free_mode":false,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"en","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"b126fa16dde18701f8e987dec12b506a"}</script><script src="/en/js/third-party/comments/gitalk.js"></script><script type="text/javascript" src="/en/js/crash_cheat.js"></script><script async src="/en/js/fireworks.js"></script><script src="https://unpkg.com/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script><script>window.splideStyles={arrowColor:"#fc8d5d",arrowHoverColor:"#fc6423",paginationColor:"#fc8d5d",paginationActiveColor:"#fc6423",paginationHoverColor:"#fc6423",borderRadius:"1px",borderColor:{light:"#eee",dark:"#444"},shadowColor:{light:"rgba(0, 0, 0, 0.1)",dark:"rgba(0, 0, 0, 0.3)"}},window.splideDarkMode="auto",window.mediumZoomEnabled=!1</script><script type="text/javascript">// 页面加载事件监听
document.addEventListener('DOMContentLoaded', function () {
    splideLoadingHandler();
    initGlobalMediumZoom();
});

document.addEventListener('pjax:success', function () {
    splideLoadingHandler();
    initGlobalMediumZoom();
});

// PJAX开启时销毁所有splide实例，不然开启自动播放时图片简介和图片对不上
document.addEventListener('pjax:send', () => {
    destroySplideInstances();
});

window.splideInstances = [];
function destroySplideInstances() {
    window.splideInstances.forEach((instance) => {
        instance.destroy(); // 销毁实例
    });
    window.splideInstances = []; // 清空数组
}

// Splid 加载处理
function splideLoadingHandler() {
    // 检查页面是否含有轮播图片
    const splideEl = document.querySelector('.splide');
    if (!splideEl) {
        return; // 如果不存在轮播，则不执行初始化
    }

    // 检查是否开启Next主题的动画
    const isMotionEnabled = typeof CONFIG !== 'undefined' && CONFIG && CONFIG.motion && CONFIG.motion.enable;
    if (isMotionEnabled) {
        // Motion 开启时延迟加载轮播组件，等待动画完成。把组件加入动画有bug，一直搞不定，只能曲线救国
        setTimeout(function () {
            // 初始化轮播组件
            initSplide();
        }, 500);  // 延迟 500ms，确保动画完成后再初始化
    } else {
        // Motion 关闭时立即初始化
        initSplide();
    }

    // 处理 fancybox，默认设置会切换焦点图片造成轮播组件混乱
    if (typeof Fancybox !== "undefined") {
        adjustFancybox();
    }

    // 初始化轮播组件中的 Medium Zoom
    if (mediumZoomEnabled) {
        initCarouselMediumZoom();
    }

    // 应用主题样式
    applySplideStyle();
}

// 初始化 Splide
function initSplide() {
    const splideElements = document.querySelectorAll('.splide');
    splideElements.forEach(splideEl => {
        const options = JSON.parse(splideEl.getAttribute('data-splide'));
        // 如果轮播组件中只有一张图片，则隐藏箭头
        const slideCount = splideEl.querySelectorAll('.splide__slide').length;
        if (slideCount <= 1) {
            options.arrows = false;
        }
        // 简介设置
        const splide = new Splide(splideEl, options);
        splide.on('mounted move', function () {
            const activeSlide = splide.Components.Slides.getAt(splide.index);
            const caption = activeSlide.slide.dataset.caption;
            const captionId = splideEl.getAttribute('data-caption-id');

            const captionElement = document.getElementById(captionId);
            if (captionElement) {
                captionElement.innerText = caption || '';  // 如果没有简介，设置为空字符串
            }
        });
        splide.mount();
        window.splideInstances.push(splide); // 将实例存储到数组中   
    });
}

// 应用主题明暗样式
function applySplideStyle() {
    const applyThemeStyles = (theme, splideStyles) => {
        const borderColor = theme === 'dark' ? splideStyles.borderColor.dark : splideStyles.borderColor.light;
        const shadowColor = theme === 'dark' ? splideStyles.shadowColor.dark : splideStyles.shadowColor.light;
        document.documentElement.style.setProperty('--carousel-border-color', borderColor);
        document.documentElement.style.setProperty('--carousel-shadow-color', shadowColor);
        document.documentElement.style.setProperty('--carousel-border-radius', splideStyles.borderRadius);
        document.documentElement.style.setProperty('--carousel-arrow-color', splideStyles.arrowColor);
        document.documentElement.style.setProperty('--carousel-arrow-hover-color', splideStyles.arrowHoverColor);
        document.documentElement.style.setProperty('--carousel-pagination-color', splideStyles.paginationColor);
        document.documentElement.style.setProperty('--carousel-pagination-active-color', splideStyles.paginationActiveColor);
        document.documentElement.style.setProperty('--carousel-pagination-hover-color', splideStyles.paginationHoverColor);
    };

    let theme = 'light';
    if (window.splideDarkMode === 'auto') {
        theme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    } else if (window.splideDarkMode === 'true') {
        theme = 'dark';
    }
    applyThemeStyles(theme, window.splideStyles);

    if (window.splideDarkMode === 'auto') {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            applyThemeStyles(e.matches ? 'dark' : 'light', window.splideStyles);
        });
    }
}

// 初始化非轮播图片的 Medium Zoom
function initGlobalMediumZoom() {
    // 检查是否启用 medium-zoom
    if (!mediumZoomEnabled) {
        return;
    }
    const zoomOutsideCarousel = mediumZoom('img:not(.splide .zoomable)', {
        background: 'rgba(0, 0, 0, 0.8)',
        margin: 24
    });
}

// 初始化轮播组件中的 Medium Zoom
function initCarouselMediumZoom() {
    const zoomCarousel = mediumZoom('.zoomable', {
        background: 'rgba(0, 0, 0, 0.8)',
        margin: 24,
        onOpen: (zoom) => {
            const img = zoom.target; // 获取正在缩放的图片
            img.classList.add('zooming'); // 添加一个缩放时的 class
        },
        onClose: (zoom) => {
            const img = zoom.target; // 获取缩放的图片
            img.classList.remove('zooming'); // 移除缩放时的 class
        }
    });

    zoomCarousel.on('open', () => {
        // 隐藏箭头和分页按钮
        document.querySelectorAll('.splide__arrow, .splide__pagination').forEach(el => {
            el.style.display = 'none';
        });
    });

    zoomCarousel.on('close', () => {
        // 重新显示箭头和分页按钮
        document.querySelectorAll('.splide__arrow, .splide__pagination').forEach(el => {
            el.style.display = '';
        });
    });
}

// fancybox 兼容调整
function adjustFancybox() {
    Fancybox.bind("[data-fancybox]", {
        placeFocusBack: false,  // 禁止 Fancybox 关闭时滚动回页面的焦点位置
    });

    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === "childList") {
                removeFancyboxFromClones();
            }
        });
    });

    // 观察整个文档的 DOM 变化
    observer.observe(document, { childList: true, subtree: true });
}

// 移除克隆 Slide 中的 Fancybox 链接
function removeFancyboxFromClones() {
    const cloneSlides = document.querySelectorAll('.splide__slide--clone');

    cloneSlides.forEach((slide) => {
        const fancyboxLink = slide.querySelector('a.fancybox');
        if (fancyboxLink) {
            const img = fancyboxLink.querySelector('img');
            if (img) {
                // 将 img 挪出 a 标签
                fancyboxLink.replaceWith(img);
            }
        }
    });
}</script></body></html>